"use strict";function TransController(){this.transitions=[],this.transitionMaps=[]}function TransMaster(e){this._init(_.extend(DEFAULTS,e))}var $b=$("body"),w=window;_.extend(TransController.prototype,{registerTransition:function(e){this.transitions.push(e)},_getTransitions:function(){return this.transitions},registerTransitionMap:function(e){this.transitionMaps.push(e)},_getTransitionMaps:function(){return this.transitionMaps}}),window.TC=new TransController;var DEFAULTS={transitionType:"box-transition",transitionMapType:"box-transition-map",pages:[{current:!0,name:"first",container:".trans-js-page-1"},{name:"second",container:".trans-js-page-2"}],debug:!1,background:"#FFFFFF",pageContainer:"body",renderTimeout:1e3};_.extend(TransMaster.prototype,{_getPage:function(e){return _.find(this._options.pages,function(t){return t.name===e})},_renderPageToCanvas:function(e,t){var n=this,i=$(e),o=$('<div class="trans-temp-container"></div>');o.html(i.clone().get(0)),o.css("background",n._options.background),o.children().show(),$b.append(o),html2canvas(o.get(0),{logging:n._options.debug,width:w.innerWidth,height:w.innerHeight,onrendered:function(e){t.call(n,e),o.remove()}})},_renderPageElements:function(e){function t(e){e.children().each(function(){function e(e){return"rgba(0, 0, 0, 0)"===e.css("background-color")?"transparent":e.css("background-color")}var n=$(this);this.myRect=this.getBoundingClientRect(),"transparent"===e(n)&&(this.style.backgroundColor="inherit"),html2canvas(n.get(0),{onrendered:function(e){n.get(0).myCanvas=e,n.get(0).myImg=e.toDataURL()}}),t(n)})}var n=this,i=e.el,o=$(i),a=$('<div class="trans-temp-container"></div>');a.html(o.clone().get(0)),a.css("background",n._options.background),a.children().show(),$b.append(a),t(a),e.domClone=a,setTimeout(function(){a.remove()},1e4)},_init:function(e){var t=e;t.debug&&(this.gui=new dat.GUI),this.$pc=$(t.pageContainer),this._options=t,this._prepareDOM(),this._generatePages(),this._initTransitions(),t.debug&&(this._debugNextPage="third",this.gui.add(this,"_debugNextPage",_.map(t.pages,function(e){return e.name})),this.gui.add(this,"_debugGoToNextPage"),this.gui.add(this,"openMap"))},_debugGoToNextPage:function(){this.goToPage(this._debugNextPage)},_prepareDOM:function(){var e=this;$b.addClass("trans-body"),this.$overlay=$('<div class="trans-overlay"></div>'),this.$overlay.css("background",this._options.background),$b.append(this.$overlay),_.each(this._options.pages,function(t){t.el=$(t.container),t.current?(e._currentPage=t,$(e._currentPage.el).show()):e._removePage(t)})},_initTransitions:function(){var e=this;this._transitions={},this._transitionMaps={},this._transitionTemp={},this._transitionMapTemp={},_.each(window.TC._getTransitions(),function(t){e.includeTransition(t)}),_.each(window.TC._getTransitionMaps(),function(t){e.includeTransitionMap(t)}),this._options.debug&&(this.gui.add(this._options,"transitionType",_.keys(this._transitions)),this.gui.add(this._options,"transitionMapType",_.keys(this._transitionMaps)))},_generatePages:function(){var e=this,t=this._options.pages;_.each(t,function(t){e._renderPageToCanvas(t.el,function(e){t.canvas=e,t.image=e.toDataURL("image/jpeg",1)}),e._renderPageElements(t),e._options.debug&&(window["pg"+t.name]=t)})},_transition:function(e,t,n){var i=this,o=Date.now();i._transitionTemp={o:i._transitions[e].options,f:i._transitions[e].gui},i._transitions[e].beforeTransition.call(i,t,n,function(a){i._options.debug&&(console.log(a),console.log("Elapsed time: "+(Date.now()-o)+"ms")),o=Date.now(),i._removePage(t),i._transitions[e].doTransition.call(i,t,n,function(a){i._options.debug&&(console.log(a),console.log("Elapsed time: "+(Date.now()-o)+"ms")),o=Date.now(),i._transitions[e].afterTransition.call(i,t,n,function(e){i._options.debug&&(console.log(e),console.log("Elapsed time: "+(Date.now()-o)+"ms")),i._putPage(n),i._currentPage=n})})})},_transitionMap:function(e,t,n){var i=this,o=Date.now();i._transitionMapTemp={o:i._transitionMaps[e].options,f:i._transitionMaps[e].gui},i._transitionMaps[e].beforeTransitionMap.call(i,t,n,function(a){i._options.debug&&(console.log(a),console.log("Elapsed time: "+(Date.now()-o)+"ms")),o=Date.now(),i._removePage(t),i._transitionMaps[e].doTransitionMap.call(i,t,n,function(a){i._options.debug&&(console.log(a),console.log("Elapsed time: "+(Date.now()-o)+"ms")),o=Date.now(),i._transitionMaps[e].afterTransitionMap.call(i,t,n,function(e,t){i._options.debug&&(console.log(e),console.log("Elapsed time: "+(Date.now()-o)+"ms")),t=i._getPage(t),i._putPage(t),i._currentPage=t})})})},_removePage:function(e){this.$pc.find(e.container).remove()},_putPage:function(e){this.$pc.append(e.el),$(w).scrollTop(0),$(e.el).show()},chooseTransition:function(e,t){this.o.transitionType=e,t&&this.setTransitionOptions(e,t)},setTransitionOptions:function(e,t){this._transitions[e].options=_.extend(this._transitions[e].options,t)},includeTransition:function(e,t){var n,i=_.extend(e.options,t);if(this._options.debug){var o=this.gui;n=o.addFolder(e.name),_.each(i,function(e,t){n.add(i,t)})}this._transitions[e.name]={options:i,gui:n,beforeTransition:e.beforeTransition,doTransition:e.doTransition,afterTransition:e.afterTransition}},includeTransitionMap:function(e,t){var n,i=_.extend(e.options,t);if(this._options.debug){var o=this.gui;n=o.addFolder(e.name),_.each(i,function(e,t){n.add(i,t)})}this._transitionMaps[e.name]={options:i,gui:n,beforeTransitionMap:e.beforeTransitionMap,doTransitionMap:e.doTransitionMap,afterTransitionMap:e.afterTransitionMap}},goToPage:function(e){var t=this._currentPage.transition?this._currentPage.transition:this._options.transitionType;this._transition(t,this._currentPage,this._getPage(e))},openMap:function(){this._transitionMap(this._options.transitionMapType,this._currentPage,this._options.pages)}});var $b=$("body"),w=window,boxTransitionDefaults={ambientLight:12303291,directionalLight:5592405,clearFaceColor:16777215,cameraDistanceMultiplier:2,allowRotationZ:!1,zoomOutTime:1e3,zoomInTime:1e3},boxTransition={options:boxTransitionDefaults,name:"box-transition",beforeTransition:function(e,t,n){var i=this._transitionTemp;i.background=this.$overlay.css("background"),this.$overlay.css("background",'url("images/box-transition-background.jpg")'),i.renderer=new THREE.WebGLRenderer({alpha:!0}),i.renderer.setSize(w.innerWidth,w.innerHeight),i.renderer.domElement.classList.add("box-transition-canvas"),document.body.appendChild(i.renderer.domElement),i.boxMultiplier=300,i.boxHeight=i.boxMultiplier/(w.innerWidth/w.innerHeight),i.cameraPos=Math.tan(67.5*Math.PI/180)*(i.boxHeight/2)+i.boxMultiplier/2,i.camera=new THREE.PerspectiveCamera(45,w.innerWidth/w.innerHeight,1,i.cameraPos*i.o.cameraDistanceMultiplier),i.camera.position.z=i.cameraPos,i.scene=new THREE.Scene,i.materialCur=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(e.image)}),i.materialNext=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(t.image)}),i.materialEmpty=new THREE.MeshLambertMaterial({color:i.o.clearFaceColor}),i.materials=[i.materialNext,i.materialNext,i.materialEmpty,i.materialEmpty,i.materialCur,i.materialCur],i.box=new THREE.Mesh(new THREE.BoxGeometry(i.boxMultiplier,i.boxHeight,i.boxMultiplier),new THREE.MeshFaceMaterial(i.materials)),i.ambientLight=new THREE.AmbientLight(i.o.ambientLight),i.directionalLight=new THREE.DirectionalLight(i.o.directionalLight),i.directionalLight.position.set(1,1,1).normalize(),i.scene.add(i.box),i.scene.add(i.ambientLight),i.scene.add(i.directionalLight);var o={cameraZ:i.cameraPos,boxRotationY:0,boxRotationZ:0},a={cameraZ:i.cameraPos*i.o.cameraDistanceMultiplier,boxRotationY:.75*Math.PI,boxRotationZ:2*Math.PI},r={cameraZ:i.cameraPos,boxRotationY:1.5*Math.PI,boxRotationZ:4*Math.PI};i.tween1=new TWEEN.Tween(o).to(a,i.o.zoomOutTime),i.tween1.onUpdate(function(){i.camera.position.z=o.cameraZ,i.box.rotation.y=o.boxRotationY,i.o.allowRotationZ&&(i.box.rotation.z=o.boxRotationZ)}),i.tween2=new TWEEN.Tween(a).to(r,i.o.zoomInTime),i.tween2.onUpdate(function(){i.camera.position.z=a.cameraZ,i.box.rotation.y=a.boxRotationY,i.o.allowRotationZ&&(i.box.rotation.z=a.boxRotationZ)}),i.tween2.easing(TWEEN.Easing.Cubic.In),i.tween1.easing(TWEEN.Easing.Cubic.Out),i.tween1.chain(i.tween2),i.stopAnimate=!1,n("Before transition - ok.")},doTransition:function(e,t,n){function i(){TWEEN.update(),o.renderer.render(o.scene,o.camera),o.stopAnimate||requestAnimationFrame(function(){i()})}var o=this._transitionTemp;o.tween1.start(),o.tween2.onComplete(function(){o.stopAnimate=!0,n("Transition - ok.")}),i()},afterTransition:function(e,t,n){var i=this._transitionTemp;$b.find(".box-transition-canvas").remove(),this.$overlay.css("background",i.background),i={},n("After transition - ok.")}};TC.registerTransition(boxTransition);var $b=$("body"),w=window,planeWobbleTransitionDefaults={ambientLight:16777215,segments:32,wobbleTime:1e3,delayInBetween:1e3,transitionTime:2e3,wobbleHeight:20},planeWobbleTransition={options:planeWobbleTransitionDefaults,name:"plane-wobble-transition",beforeTransition:function(e,t,n){var i=this._transitionTemp;i.renderer=new THREE.WebGLRenderer({alpha:!0}),i.renderer.setSize(w.innerWidth,w.innerHeight),i.renderer.domElement.classList.add("plane-wobble-transition-canvas"),document.body.appendChild(i.renderer.domElement),i.planeMultiplier=300,i.planeHeight=i.planeMultiplier/(w.innerWidth/w.innerHeight),i.cameraPos=Math.tan(67.5*Math.PI/180)*(i.planeHeight/2),i.camera=new THREE.PerspectiveCamera(45,w.innerWidth/w.innerHeight,1,1e3),i.camera.position.z=i.cameraPos,i.scene=new THREE.Scene,i.materialCur=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(e.image)}),i.materialNext=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(t.image)}),i.geometryCur=new THREE.PlaneGeometry(i.planeMultiplier,i.planeHeight,i.o.segments,i.o.segments),i.geometryCur.dynamic=!0,i.geometryNext=new THREE.PlaneGeometry(i.planeMultiplier,i.planeHeight,1,1),i.planeCur=new THREE.Mesh(i.geometryCur,i.materialCur),i.planeNext=new THREE.Mesh(i.geometryNext,i.materialNext),i.planeNext.position.z=2*-i.o.wobbleHeight,i.ambientLight=new THREE.AmbientLight(i.o.ambientLight),i.scene.add(i.planeCur),i.scene.add(i.planeNext),i.scene.add(i.ambientLight),i.begin={curMult:0};var o={curMult:1},a={nextZ:2*-i.o.wobbleHeight},r={nextZ:0};i.tween1=new TWEEN.Tween(i.begin).to(o,i.o.wobbleTime),i.tween1.onUpdate(function(){i.planeCur.position.z=-i.begin.curMult*i.o.wobbleHeight}),i.tween1.easing(TWEEN.Easing.Cubic.InOut),i.tween2=new TWEEN.Tween(a).to(r,i.o.transitionTime),i.tween2.onUpdate(function(){i.planeNext.position.z=a.nextZ}),i.tween2.easing(TWEEN.Easing.Cubic.InOut),i.tween2.delay(i.o.delayInBetween),i.tween1.chain(i.tween2),i.stopAnimate=!1,n("Before transition - ok.")},doTransition:function(e,t,n){function i(e){TWEEN.update(),_.each(o.planeCur.geometry.vertices,function(t,n){t.z=o.planeCur.position.z+(Math.sin(e/1e3+n%o.o.segments)/2+1)*o.begin.curMult*o.o.wobbleHeight-.01}),o.planeCur.geometry.verticesNeedUpdate=!0,o.renderer.render(o.scene,o.camera),o.stopAnimate||requestAnimationFrame(function(e){i(e)})}var o=this._transitionTemp;o.tween1.start(),o.tween2.onComplete(function(){o.stopAnimate=!0,n("Transition - ok.")}),i(Date.now()/1e3)},afterTransition:function(e,t,n){var i=this._transitionTemp;$b.find(".plane-wobble-transition-canvas").remove(),i={},n("After transition - ok.")}};TC.registerTransition(planeWobbleTransition);var $b=$("body"),w=window,cityTransitionDefaults={ambientLight:12303291,directionalLight:5592405,clearFaceColor:16777215,cameraDistanceMultiplier:2,zoomOutTime:1e3,zoomInTime:1e3,boxMultiplier:300,boxHeight:10},cityTransition={options:cityTransitionDefaults,name:"city-transition",beforeTransition:function(e,t,n){function i(e){a.f.add(e.rotation,"x",-Math.PI,Math.PI),a.f.add(e.rotation,"y",-Math.PI,Math.PI),a.f.add(e.rotation,"z",-Math.PI,Math.PI),a.f.add(e.position,"x",-1e3,1e3),a.f.add(e.position,"y",-1e3,1e3),a.f.add(e.position,"z",-1e3,1e3)}function o(e,t,n){t++,e.children().each(function(){var e=$(this),i=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(this.myImg)}),r=[a.materialEmpty,a.materialEmpty,i,a.materialEmpty,a.materialEmpty,a.materialEmpty],s=new THREE.Mesh(new THREE.BoxGeometry(this.myRect.width,a.o.boxHeight*t*8,this.myRect.height),new THREE.MeshFaceMaterial(r));s.position.x=this.myRect.left+this.myRect.width/2-a.boxWidth/2,s.position.y=a.mapPositionY+a.o.boxHeight*t*2,s.position.z=this.myRect.top+this.myRect.height/2-a.boxHeight/2,a.scene.add(s),n.push(s),o(e,t,n)})}var a=this._transitionTemp;a.background=this.$overlay.css("background"),this.$overlay.css("background",'url("images/city-transition-background.jpg")'),a.renderer=new THREE.WebGLRenderer({alpha:!0}),a.renderer.setSize(w.innerWidth,w.innerHeight),a.renderer.domElement.classList.add("city-transition-canvas"),document.body.appendChild(a.renderer.domElement),a.boxMultiplier=a.o.boxMultiplier,a.cameraPos=400,a.camera=new THREE.PerspectiveCamera(45,w.innerWidth/w.innerHeight,1,a.cameraPos*a.o.cameraDistanceMultiplier*10),a.camera.position.z=a.cameraPos,a.camera.position.y=300,a.camera.rotation.x=-Math.PI/4,i(a.camera),a.scene=new THREE.Scene,a.materialCur=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(e.image)}),a.materialNext=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(t.image)}),a.materialEmpty=new THREE.MeshLambertMaterial({color:a.o.clearFaceColor}),a.materialMap=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture("images/paper-map.jpg"),side:THREE.DoubleSide}),a.mapPositionY=-200,a.mapPlane=new THREE.Mesh(new THREE.PlaneGeometry(5e3,5e3),a.materialMap),a.mapPlane.rotation.x=Math.PI/2,a.mapPlane.position.y=a.mapPositionY,a.scene.add(a.mapPlane),a.box=new THREE.Mesh(new THREE.BoxGeometry(e.el.width(),a.o.boxHeight,e.el.height()),a.materialEmpty),a.box.position.y=a.mapPositionY+a.o.boxHeight/2,a.boxWidth=e.el.width(),a.boxHeight=e.el.height(),a.boxArray=[],o(e.domClone,0,a.boxArray),a.ambientLight=new THREE.AmbientLight(a.o.ambientLight),a.directionalLight=new THREE.DirectionalLight(a.o.directionalLight),a.directionalLight.position.set(500,40,1).normalize(),a.scene.add(a.ambientLight),a.scene.add(a.directionalLight);var r={cameraZ:a.cameraPos,boxRotationY:0,boxRotationZ:0},s={cameraZ:a.cameraPos*a.o.cameraDistanceMultiplier,boxRotationY:.75*Math.PI,boxRotationZ:2*Math.PI},c={cameraZ:a.cameraPos,boxRotationY:1.5*Math.PI,boxRotationZ:4*Math.PI};a.tween1=new TWEEN.Tween(r).to(s,a.o.zoomOutTime),a.tween1.onUpdate(function(){a.camera.position.z=r.cameraZ}),a.tween2=new TWEEN.Tween(s).to(c,a.o.zoomInTime),a.tween2.onUpdate(function(){a.camera.position.z=s.cameraZ}),a.tween2.easing(TWEEN.Easing.Cubic.In),a.tween1.easing(TWEEN.Easing.Cubic.Out),a.stopAnimate=!1,n("Before transition - ok.")},doTransition:function(e,t,n){function i(){TWEEN.update(),o.renderer.render(o.scene,o.camera),o.stopAnimate||requestAnimationFrame(function(){i()})}var o=this._transitionTemp;o.tween1.start(),o.tween2.onComplete(function(){o.stopAnimate=!0,n("Transition - ok.")}),i()},afterTransition:function(e,t,n){var i=this._transitionTemp;$b.find(".city-transition-canvas").remove(),this.$overlay.css("background",i.background),i={},n("After transition - ok.")}};TC.registerTransition(cityTransition);var $b=$("body"),w=window,boxTransitionMapDefaults={ambientLight:12303291,directionalLight:5592405,clearFaceColor:16777215,cameraDistanceMultiplier:3,zoomOutTime:1e3,zoomInTime:1e3},boxTransitionMap={options:boxTransitionMapDefaults,name:"box-transition-map",beforeTransitionMap:function(e,t,n){var i=this._transitionMapTemp;i.onDocumentMouseDown=function(e){if(!i.stopListening){e.preventDefault(),i.mouse.x=e.clientX/i.renderer.domElement.width*2-1,i.mouse.y=2*-(e.clientY/i.renderer.domElement.height)+1,i.raycaster.setFromCamera(i.mouse,i.camera);var t=i.raycaster.intersectObjects(i.boxes);if(t.length>0){var n=t[0].object;i.nextPage=n.pageName,i.end.x=n.position.x,i.end.y=n.position.y,n.hover=!1,i.checkHoverStates(),i.stopListening=!0,i.tween2.start()}}},i.onDocumentMouseMove=function(e){if(!i.stopListening){i.mouse.x=e.clientX/i.renderer.domElement.width*2-1,i.mouse.y=2*-(e.clientY/i.renderer.domElement.height)+1,i.raycaster.setFromCamera(i.mouse,i.camera);var t,n=i.raycaster.intersectObjects(i.boxes);n.length>0&&(t=n[0].object.pageName),_.each(i.boxes,function(e){t===e.pageName?e.hover||(e.hover=!0):e.hover&&(e.hover=!1),i.checkHoverStates()})}},i.onDocumentTouchStart=function(e){e.preventDefault(),e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY,i.onDocumentMouseDown(e)},i.checkHoverStates=function(){_.each(i.boxes,function(e){e.previousHover===e.hover?(e.hoverIn=!1,e.hoverOut=!1):e.previousHover?e.hoverOut=!0:e.hoverIn=!0,e.hoverIn&&(e.tween=new TWEEN.Tween({z:e.position.z}).to({z:100},150),e.tween.easing(TWEEN.Easing.Cubic.InOut),e.tween.onUpdate(function(){e.position.z=this.z}),e.tween.start()),e.hoverOut&&(e.tween=new TWEEN.Tween({z:e.position.z}).to({z:0},150),e.tween.easing(TWEEN.Easing.Cubic.InOut),e.tween.onUpdate(function(){e.position.z=this.z}),e.tween.start()),e.previousHover=e.hover})},i.throttledMouseMove=_.throttle(i.onDocumentMouseMove,40),document.addEventListener("mousedown",i.onDocumentMouseDown,!1),document.addEventListener("touchstart",i.onDocumentTouchStart,!1),document.addEventListener("mousemove",i.throttledMouseMove,!1),i.raycaster=new THREE.Raycaster,i.mouse=new THREE.Vector2,i.background=this.$overlay.css("background"),this.$overlay.css("background",'url("images/box-transition-background.jpg")'),i.renderer=new THREE.WebGLRenderer({alpha:!0}),i.renderer.setSize(w.innerWidth,w.innerHeight),i.renderer.domElement.classList.add("box-transition-canvas"),document.body.appendChild(i.renderer.domElement),i.boxMultiplier=300,i.boxHeight=i.boxMultiplier/(w.innerWidth/w.innerHeight),i.cameraPos=Math.tan(67.5*Math.PI/180)*(i.boxHeight/2)+i.boxMultiplier/2,i.camera=new THREE.PerspectiveCamera(45,w.innerWidth/w.innerHeight,1,i.cameraPos*i.o.cameraDistanceMultiplier*10),i.camera.position.z=i.cameraPos,i.scene=new THREE.Scene,i.materialEmpty=new THREE.MeshLambertMaterial({color:i.o.clearFaceColor}),i.boxes=[],_.each(t,function(t){var n=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(t.image)}),o=[n,n,i.materialEmpty,i.materialEmpty,n,n],a=new THREE.Mesh(new THREE.BoxGeometry(i.boxMultiplier,i.boxHeight,i.boxMultiplier),new THREE.MeshFaceMaterial(o));a.pageName=t.name,t.name===e.name&&(i.curBox=a),i.boxes.push(a),i.scene.add(a)}),i.boxes[0].position.x=i.boxMultiplier+.1*i.boxMultiplier,i.boxes[2].position.x=-i.boxes[0].position.x,i.materials=[i.materialCur,i.materialCur,i.materialEmpty,i.materialEmpty,i.materialCur,i.materialCur],i.ambientLight=new THREE.AmbientLight(i.o.ambientLight),i.directionalLight=new THREE.DirectionalLight(i.o.directionalLight),i.directionalLight.position.set(1,1,1).normalize(),i.scene.add(i.ambientLight),i.scene.add(i.directionalLight),i.begin={z:i.cameraPos,x:i.curBox.position.x,y:i.curBox.position.y},i.middle={z:i.cameraPos*i.o.cameraDistanceMultiplier,x:0,y:0},i.end={z:i.cameraPos,x:0,y:0},i.tween1=new TWEEN.Tween(i.begin).to(i.middle,i.o.zoomOutTime),i.tween1.onUpdate(function(){i.camera.position.x=this.x,i.camera.position.y=this.y,i.camera.position.z=this.z}),i.tween2=new TWEEN.Tween(i.middle).to(i.end,i.o.zoomInTime),i.tween2.onUpdate(function(){i.camera.position.x=this.x,i.camera.position.y=this.y,i.camera.position.z=this.z}),i.tween2.easing(TWEEN.Easing.Cubic.In),i.tween1.easing(TWEEN.Easing.Cubic.Out),i.stopAnimate=!1,n("Before transition map - ok.")},doTransitionMap:function(e,t,n){function i(){TWEEN.update(),o.renderer.render(o.scene,o.camera),o.stopAnimate||requestAnimationFrame(function(){i()})}var o=this._transitionMapTemp;o.tween1.start(),o.tween2.onComplete(function(){o.stopAnimate=!0,n("Transition map - ok.")}),i()},afterTransitionMap:function(e,t,n){var i=this._transitionMapTemp;$b.find(".box-transition-canvas").remove(),this.$overlay.css("background",i.background);var o=i.nextPage;document.removeEventListener("mousedown",i.onDocumentMouseDown,!1),document.removeEventListener("touchstart",i.onDocumentTouchStart,!1),document.removeEventListener("mousemove",i.throttledMouseMove,!1),i={},n("After transition map - ok.",o)}};TC.registerTransitionMap(boxTransitionMap);var TM=new TransMaster({transitionType:"plane-wobble-transition",pages:[{current:!0,name:"first",container:".trans-js-page-1"},{name:"second",container:".trans-js-page-2"},{name:"third",container:".trans-js-page-3"}],debug:!0,background:"#FFFFFF",pageContainer:"body"});$("body").on("click",".js-change-page",function(){var e=$(this);TM.goToPage(e.data("page"))}),$("body").on("click",".js-map",function(){TM.openMap()}),window.tm=TM;